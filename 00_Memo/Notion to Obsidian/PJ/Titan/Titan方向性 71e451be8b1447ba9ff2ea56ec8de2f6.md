# Titan方向性

## Titanの状況

- Titanの課題（Tenderの処理部分）
    - Input
        - 取り込み・Validationチェック（☓、Unstructuredだと全く取り込めない）
        - マッピング（△、手でポチポチマッピングしないといけないため時間がかかる）
        - OPUSコード変換（○、うまく変換できない場合はOPUSコードを選択して変換できる）
    - Output
        - 元ファイルへコード変換
        - 元ファイルへマッピング
        - ファイル出力（☓、作り直しているので、もともとのEXCELの様々な書式が再現できなく、手作業でのコピー＆ペーストが発生してしまう）
- Titanのカバレッジ
    - Pure Titan⇒約10％
    - 直近のTitan workable⇒約40％
        - Titan workableには下記の2点が含まれている
            - Semi-automation：手作業でデータを修正（複数Tabのデータをユニオンしたり）したり、カラムを追加したりした後にTitanに取り込む
            - Simplified Sales format：Titanの固定フォーマットに手作業で変えてもらって取り込むを行う
            
            ※On shore tender向けにこれらのやり方を動画等で撮影してユーザに提供
            

## Titan Back log

- Tiger/Titan integration
- Simplified Workflow(9/16に完成予定)
    - 固定フォーマットを用意することでマッピングを飛ばして取り込み可能な機能
- 性能問題（一部改修しているものの根本的な対処はできていない）
- 10月4日以降の開発は要検討

## 今後の開発の方向性

### 方向性

- On shoreから可能な限りOff shoreへ移行していく
- データの変換はプロであるETLに任せる（Titanで無理に作らない）

### 短期

- フローイメージは以下の通り
    1. TenderをETLでTitanフォーマット（Simplified formatもしくはTitan readable format）に変換
    2. Titanで取り込み（Simplified formatもしくは通常での取り込み）
    3. TigerでPricingしTitanへ
    4. Titanに戻してExport
    5. マニュアルで元のTenderシートに貼り付けてお客さんに返す、もしくはETLで変換の逆を行って元シートを作り直す（この場合も、手作業でのCopy&Pasteは発生してしまうと想定）
    
    ※1については初回フォーマットの設定には時間がかかってしまうが、次回以降は基本的にフォーマットがかわらないため素早く実施可能
    
    ※1についての主な変換内容は下記の通り
    
    - 縦持ち・横持ちデータのピポット
    - 複数シートのヘッダが同じ場合のデータのUnion
    - 複数シートでヘッダが異なる場合のデータを結合してマージ（キーがない場合は要検討）
    - グループロケーションの行の分割
    - （Simplified formatを使う場合は）列の並び替え
    
    ※SalesにETLの変換をやってもらうのは難易度が高いため、まずは上記フローはOff shoreに持っていくことが前提となる
    
    ※Off shoreはOMMCはリソースに限りがあるがWNSはかなり柔軟にリソースを相談可能
    
    ※1でどうしても対応できない場合はマンパワーを活用したマニュアルコンバージョンのルートも事前に用意しておく
    
    - 変換を行うETLの候補は下記の通り（Alteryx, Tableau Prep, Google Sheet)
        
        
        |  | 提供形態 | メリット | デメリット |
        | --- | --- | --- | --- |
        | Alteryx | ・アプリ型
        ・Server型
        ・SDK | ・変換に関しては一番高機能
        ・SDK等が提供されていて拡張性がある | ・使うのが少し難易度高い
        ・ライセンス代
        ・1個1個設定をしていかないといけない、変更があるとその設定を見直さないといけない |
        | Tableau Prep | ・アプリ型
        ・Server型 | ・変換に必要な機能はある
        ・ライセンスはCreatorライセンスを使用可能（ONEはDesktopのライセンスをかなり保持していると想定） | ・使う難易度はAlteryxより簡易
        ・1個1個設定をしていかないといけない、変更があるとその設定を見直さないといけない |
        | Google Sheet | ・Webサービス | ・無料
        ・各種関数等習熟コストは高くない
        ・設定変更は柔軟に対応できる | ・1個1個設定をしていかないといけない
        ・膨大な数のGoogle Sheetが出来上がってしまう |
    - 
    
    ### 道田さんコメント
    
    - 過去のTenderを受領して変換を事前に組み始めておく、去年のテンプレートという形でユーザに提供できるようにする（Tenderを受け取ってから作業を始めたらとても間に合わない）
    - 上記についていつ誰が何をするかアレンジする（In out含めて）
    - Off shoreはもうあるものを解析し始める。On shoreのテンダーはユーザからもらって解析する
    - オフショアである程度マニュアルでやるのは仕方ないと割り切る（リソース追加して、プロセスで対応するのも1手段と考えるべき）

### 中長期（要検討）

### 案１

- ETLをTitanに組込むことを検討する（下記ETLをAlteryxとしたイメージを記載）
    - すべての処理をTitan上で完結させる
        - Alteryxのサーバーを立てて、Titanと連携させる
- フローイメージは以下の通り
    1. Titanにログインして、Tender取り込みメニュー押下
    2. 自動でAlteryxにシングルサインオンして、ファイル加工画面を表示対象のTenderの処理を選択する（処理は過去のものをベースに事前に組み込んでおく）
    3. Runを押下すると、抽出が始まり、Simplified formatの形になったあと、AlteryxサーバーからTitanサーバーに送信
    4. Simplified formatで自動で取り込まれて、OPUSへの変換画面が表示される
    5. Tigerに連携してTigerでPricingしTitanへ
    6. Tenderへの戻りは前処理で実施したことの逆をプログラムで実行する、もしくは、元Tenderのターゲットカラムを特定して、そこを埋める処理を実施する（ただし、現行のTitanはすべてのデータを作り直す仕様になっている）
    
    ※技術的な検証が必要。ServerやSDKに強い人材がMustで、OTSVとの連携が必要。
    
    ※短期の方でETLの変換を実施した場合、その変換内容の移行が可能
    
    ※6はお客さんのExcelの関数やマクロが仕込まれていたりするため、ある程度手作業でのコピー＆ペーストは許容する
    

### 案2

- ETL変換後、Tigerへ直接連携する（Titanを廃止する）
- フローイメージは以下の通り
    1. ETLサーバーにログインして対象プロセスを選択して実行（Tigerフォーマットへ変換）
    2. ETLサーバーからTigerサーバーにデータ送信
    3. TigerでPricing
    4. Tenderへの戻りは前処理で実施したことの逆をプログラムで実行する（ただし、ここは案１と同様にある程度マニュアルを共用する）
- 案1に対してシンプルだが、Tigerフォーマットへのマッピング、OPUSコードの変換をETL上で実施する必要がある。特にOPUSコードに変換できなかったときにTitanの場合はユーザが該当のOPUSコードを自分で選択して変換できるプロセスがあるが、これをETLで実現するのは難易度が高い。基本的にTiger取り込みエラーになり、元ファイルを直してからETLを再実行するなどのフローを想定。（TigerにValidation検証でエラーデータを明示できることが前提）

![Untitled](Titan%E6%96%B9%E5%90%91%E6%80%A7/Untitled.png)

## スライドイメージ

### 事前準備（去年のものをベースに設定をし始める、1回設定できたら以降は不要）

- Off shore->TSTから収集
- On shore->Salesから収集
- 評価ー仕分人が下記を仕分ける(PJメンバー)
    1. ETLで完全にいけるもの
    2. ETLで一部タスクをサポートできるもの
    3. マニュアルコンバージョン
- ETLで完全にいけるもの（ETLチーム）
    - ETLの設定でプロセスフローを作っておく
- ETLで一部タスクをサポートできるもの（ETLチーム＋WNS）
    - ETLでフローを作りつつ、マニュアルで作らないといけない内容を明確化（ドキュメント化）⇒WNSに指示、内容を把握させる
- マニュアルコンバージョン（WNS）
    - マニュアルで作らないといけない内容を明確化（ドキュメント化）⇒WNSに指示、内容を把握させる

※Tenderのフォーマットは基本的にかわらないという前提

## Tender受領後

- Salesから受領
- Tenderのフォーマットが変わっているかどうか判定（仕訳人）
- 変わっていない
    - 1の場合
        - ETLを実行⇒Titanに取り込み（ETLチーム）
            - Simplified formatで可能
            - Simplified formatで不可能⇒通常ルートで取り込み
                - OPUSコードの変換がわからない場合はTitanにログインして変えてもらう
        - Tigerに連携（Pricing）
        - Pricing後、TigerからTitanへ
        - Titanからエクスポート（ETLチーム）
        - ETLで逆処理を実行（要確認）
        - オリジナルファイルへコピー＆ペースト（WNS）
        - Salesへ送付（WNS）
    - 2の場合
        - ETLを実行（ETLチーム）
        - マニュアル作業実施（WNS）
        - Titanに取り込み（WNS）
            - Simplified formatで可能
            - Simplified formatで不可能⇒通常ルートで取り込み
                - OPUSコードの変換がわからない場合はTitanにログインして変えてもらう
        - Tigerに連携（Pricing）
        - Pricing後、TigerからTitanへ
        - Titanからエクスポート（ETLチーム）
        - ETLで逆処理を実行（要確認）
        - オリジナルファイルへコピー＆ペースト（WNS）
        - Salesへ送付（WNS）
    - 3の場合
        - マニュアル作業実施（WNS）
        - Titanに取り込み（WNS）
            - Simplified formatで可能
            - Simplified formatで不可能⇒通常ルートで取り込み
                - OPUSコードの変換がわからない場合はTitanにログインして変えてもらう
        - Tigerに連携（Pricing）
        - Pricing後、TigerからTitanへ
        - Titanからエクスポート（ETLチーム）
        - オリジナルファイルへコピー＆ペースト（WNS）
        - Salesへ送付（WNS）
    - 変わっている場合
        - ETLをすぐ組んで取り込み可能か判断
            - 可能
                - ETLを組む⇒ETLを実行⇒Titanに取り込み（ETLチーム）
                    - Simplified formatで可能
                    - Simplified formatで不可能⇒通常ルートで取り込み
                        - OPUSコードの変換がわからない場合はTitanにログインして変えてもらう
                - Tigerに連携（Pricing）
                - Pricing後、TigerからTitanへ
                - Titanからエクスポート（ETLチーム）
                - ETLで逆処理を実行（要確認）
                - オリジナルファイルへコピー＆ペースト（WNS）
                - Salesへ送付（WNS）
        - 不可能
            - マニュアル作業実施（WNS）
            - Titanに取り込み（WNS）