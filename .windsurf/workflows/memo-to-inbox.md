# Memo→Inbox変換

## Description
00_Memoの雑なメモを全て01_Inboxの形式に整形して変換します（承認不要で自動実行）。

**重要**: 全てのファイルの中身を必ず読み込んで、内容を丁寧に分析してから整形します。

## 使用するツール
- `glob_file_search`: `.md` ファイルを検索
- `read_file`: ファイル内容を読み込む（複数ファイルを並列実行可能）
- `write`: Inbox形式のファイルを作成
- `run_terminal_cmd`: ファイルの移動（mvコマンド）、Pythonスクリプトの実行
- `delete_file`: ファイルの削除（必要な場合）
- `grep`: 数値パターンや特定の文字列を検索（大きなファイルの分析に有効）

## Prompt
指定された00_Memoのメモを01_Inboxの形式に整理して移動してください。

引数:
- Memoファイル名（省略可）: 変換元のファイル。省略時は00_Memo内の全ファイルをリスト表示

実行内容:
1. 00_Memoのメモを全て読み込む
2. 内容を分析して整理
3. 日付フォーマット `YYYYMMDD_内容.md` でファイル名を生成
4. 内容を整形して01_Inbox形式に変換
5. **自動的に** `01_Inbox/` に作成
6. 元のファイルは `99_Archive/` に移動
7. 変換後に00_Memo内の空のフォルダを自動削除

## 変換ルール

### ファイル名
- 元のファイル名に関係なく、内容からタイトルを生成
- 形式: `YYYYMMDD_内容.md`
- 例: `20251022_Next.jsのApp Router入門.md`

### 内容構成
```markdown
# [タイトル]

## 概要
[何についてのメモか、1-2文で要約]

## 内容
[元のメモの内容を整理]

## 次アクション
- [ ] 調べる必要があること
- [ ] 関連ノートにリンク

#inbox #tag1 #tag2
```

### トピック分割の判断基準
1つのメモに複数のトピックが含まれている場合、分割する：
- そのトピックだけで1つの独立したノートになるか？
- 別のトピックと混ぜても理解に支障がないか？
- 検索した時に「○○について知りたい」で見つかるか？

分割する場合は、各トピックごとに別ファイルを作成

## 出力形式

```markdown
## Memo→Inbox変換レポート

### 変換対象ファイル
- 00_Memo/[元のファイル名]

### 作成されるファイル
1. 01_Inbox/YYYYMMDD_タイトル1.md
   - 内容: [要約]
   - トピック数: [分割した場合]

2. 01_Inbox/YYYYMMDD_タイトル2.md
   - 内容: [要約]
   - トピック数: [分割した場合]

### 変換後の内容プレビュー

---

（変換後のプレビューをここに表示）

---

## 実行結果
✅ 01_Inbox/YYYYMMDD_タイトル1.md を作成しました
✅ 元のファイルは 99_Archive/ に移動しました
✅ 空のフォルダ0個を削除しました
```

## 実行手順

### ステップ1: ファイルの検索とリスト化
1. `00_Memo/` 内の全てのファイルを検索（`.md`、`.pptx`、`.pdf`、`.xlsx`、`.xls`など、日付フォルダ内も含む）
2. ファイル一覧を取得
3. 引数が指定されている場合は該当ファイルのみ、省略されている場合は全ファイルを処理
4. **非MDファイル（PPTX、PDF、XLSX）も必ず処理対象に含める**

### ステップ2: ファイルの読み込み（最重要）
**全ファイルを必ず1つ1つ丁寧に読み込む**

#### MDファイルの読み込み
1. **全てのMDファイルの中身を必ず読み込む**（ファイル名だけで判断しない）
2. 複数ファイルがある場合でも、各ファイルの内容をしっかり確認する
3. `read_file` ツールを使って、ファイル全体を読み込む（複数ファイルを並列読み込み可能だが、各ファイルの内容は必ず確認）
4. **大きなファイル（5万行以上など）の場合は、チャンクで読み込むか、`grep`を使って数値パターンや重要な情報を抽出**

#### 非MDファイル（PPTX、PDF、XLSX）の読み込み
**重要**: これらのファイルは表面的な情報だけでなく、**具体的な数値、実例、詳細な内容を全て取り込む**

1. **PPTXファイル（.pptx）**:
   - Pythonスクリプト（`extract_pptx.py`）を作成してテキスト抽出
   - `python-pptx`ライブラリを使用
   - 全てのスライドからテキストを抽出（タイトル、本文、テーブル内の数値など）
   - UTF-8エンコーディングで出力（`sys.stdout.buffer.write(result.encode('utf-8', errors='replace'))`）
   - **具体的な数値、パーセンテージ、金額、日付なども全て取り込む**

2. **PDFファイル（.pdf）**:
   - Pythonスクリプト（`extract_pdf.py`）を作成してテキスト抽出
   - `PyPDF2`ライブラリを使用（必ずインストール確認: `pip install PyPDF2`）
   - 全てのページからテキストを抽出
   - UTF-8エンコーディングで出力
   - **具体的な数値、表の内容、図表の説明なども全て取り込む**

3. **XLSX/XLSファイル（.xlsx、.xls）**:
   - Pythonスクリプト（`extract_xlsx.py`）を作成してテキスト抽出
   - `openpyxl`ライブラリを使用（必ずインストール確認: `pip install openpyxl`）
   - **重要**: **全てのシートを必ず処理する**（シート名を確認して、空のシートでも全て処理）
   - **重要**: **全ての行・列からデータを抽出する**（サンプルではなく、全量を取得）
   - 各シートごとに構造化して整理（シート名、行数、列数を明記）
   - UTF-8エンコーディングで出力（`sys.stdout.buffer.write(result.encode('utf-8', errors='replace'))`）
   - **セル内の数値、日付、文字列なども全て取り込む**
   - **大きなファイル（数万行以上）でも、全てのデータを取得する**（チャンク処理やサンプル抽出ではなく、全量を処理）
   - シートごとに見出しを付けて、どのシートのデータか明確にする

4. **抽出スクリプトの実行**:
   - `run_terminal_cmd`を使ってPythonスクリプトを実行
   - 出力をファイルに保存してから`read_file`で読み込む
   - エラーが発生した場合は、エンコーディング問題を確認（UTF-8に統一）

#### 数値や実例の詳細な抽出
1. **`grep`ツールを活用**:
   - 数値パターン: `USD\s*\d+[,\d]*|\d+[,\d]*\s*USD|\d+[,\d]*\s*TEU|\d+[,\d]*\s*days|\d+[,\d]*\s*%`
   - B/L番号、Booking番号: `BL:|B/L:|Booking:|TPEF|TAOFJ|ONEYSZPF`
   - 顧客名、組織名: `STARCARGO|MAVIJU|FARLETZA|PLUSCARGO`
   - 日付パターン: `\d{4}-\d{2}-\d{2}|December|November|January`

2. **実例の抽出**:
   - ケーススタディ、具体例、実績データを全て取り込む
   - 金額、数量、パーセンテージ、日付などの数値データを漏らさない
   - 顧客別のルール、特別条件、例外ケースも詳細に記録

### ステップ3: 変換処理（全てのファイル）
**全てのファイルを整形してInbox形式に変換する**

1. **メタデータの削除**: 
   - `---` で囲まれたメタデータセクションを削除
   - `## 💡 学んだ概念・パターン` などのTODOセクションを削除
   - `## 🔗 関連ノート` の空のセクションを削除
   - セッションID、時刻などのメタ情報を削除

2. **内容の整理**:
   - 実際の知識や説明の部分を抽出
   - コード例や実践的な内容を残す
   - 構造化された見出しと内容を保持
   - メタデータのみのファイルでも、構造化して保存
   - **数値データの取り込み**: 金額、数量、パーセンテージ、日付などの具体的な数値を必ず含める
   - **実例の取り込み**: ケーススタディ、具体例、実績データを詳細に記録
   - **表面的な情報だけでなく、詳細な内容を全て取り込む**（「薄っぺらい」変換を避ける）

3. **タイトルの生成**:
   - 内容から最も適切なタイトルを生成
   - 具体性を持たせる（元のファイル名の内容部分を活用）
   - メタデータのみの場合は、ファイル名や内容から推測

4. **Inbox形式への変換**:
   - 日付: 今日の日付（YYYYMMDD形式）
   - ファイル名: `YYYYMMDD_タイトル.md`
   - 内容: 整理された構造化されたメモ

5. **ファイルの作成**:
   - `01_Inbox/` フォルダに新規ファイルを作成
   - 内容を書き込む

### ステップ4: アーカイブ移動
1. 全ての元ファイルを `99_Archive/` に移動
2. 同名ファイルが存在する場合は番号を付ける

### ステップ5: 空フォルダの削除
1. `00_Memo/` 内の空のフォルダを検索
2. 空のフォルダを全て削除（README.md等も含む）
3. 削除したフォルダ数を記録

### ステップ6: 結果の報告
処理結果をまとめて報告：
- 変換したファイル数
- 削除した空フォルダ数
- エラー数と理由

## 重要：変換時の注意点

### 基本方針
**全てのファイルを必ず読み込んで整形する**

ファイル名だけで判断せず、必ずファイルの中身を全て読んでから整形すること。

### 非MDファイル処理の重要原則
**PPTX、PDF、XLSXファイルは表面的な情報だけでなく、具体的な数値や実例も全て取り込む**

- ❌ **ダメな例**: 「KPI Reviewのプレゼンテーション資料」という要約だけ
- ✅ **良い例**: 「KPI Review (1H2025): 売上USD 1,200万（前年比+15%）、コンテナ数5,000 TEU、主要顧客A社の実績200 TEU/月、B社の実績150 TEU/月...」という詳細な数値と実例を含む

### 数値と実例の抽出ルール
1. **数値パターンの検索**: `grep`を使って数値、金額、パーセンテージ、日付などを抽出
2. **実例の記録**: 顧客名、B/L番号、Booking番号、具体的なケースを全て記録
3. **詳細な情報**: 表面的な要約ではなく、次回同じ業務ができるレベルの詳細さを目指す
4. **XLSXファイルの場合**: 
   - **全シート処理**: シート名を確認し、空のシートでも全て処理する
   - **全データ取得**: サンプルではなく、全ての行・列からデータを抽出する
   - **シート構造の明記**: 各シートの行数、列数を明記し、どのシートのデータか明確にする
   - **大きなファイル**: 数万行以上のファイルでも、チャンク処理やサンプル抽出ではなく、全量を処理する

### メタデータのみのファイルの処理
メタデータのみのファイルでも、以下のように整理して変換する：

```markdown
# [元のファイル名または内容から推測したタイトル]

## 概要
セッション記録やファイル操作の記録

## 内容
[メタデータから推測できる内容]
- セッションID: xxx
- 日時: xxx
- 種別: xxx

## 次アクション
- [ ] 必要に応じて内容を確認

#inbox #session-record
```

### 実質的な内容があるファイルの処理
実質的な知識や学びが含まれているファイルは、それを中心に整形する：

```markdown
# [内容から生成したタイトル]

## 概要
[何についてのメモか、1-2文で要約]

## 内容
[実質的な知識や学びを整理]

## 次アクション
- [ ] 関連ノートにリンク
- [ ] 必要に応じてMemory Noteに変換

#inbox #tag1 #tag2
```

## ヒント

- **自動実行**: 承認不要で即座に移動します
- 完全に自由な形式のメモを整理
- トピックが複数ある場合は分割を推奨
- ファイル名は必ず内容から生成
- 日付は今日の日付を使用
- 元のファイルは99_Archiveに移動（削除ではなく）
- トピックが不明確な場合は[[07_System/Documentation/system-overview.md]]を参照

関連プロンプト: [[08_prompts/01_整理系/20250113_Memo→Inbox変換.md]]

## 使用例

```
/memo-to-inbox                    # 00_Memo内の全ファイルをリスト表示
/memo-to-inbox 雑メモ.md         # 特定のファイルを変換
/memo-to-inbox 学んだこと.txt     # 拡張子が違ってもOK
```

## 処理例

### 例1: MDファイルの変換

全てのファイルが必ずInbox形式に変換されます。メタデータのみのファイルでも、構造化して保存します。

ファイル: `2025-10-23-10-04-59_セッション終了_完了.md`

**読み込んだ内容**:
```markdown
---
type: cursor-session
event: stop
date: 2025-10-23
tags: [cursor, ai-conversation, session-end]
---
# ✅ セッション終了記録
## 📊 セッション概要
- ステータス: completed
```

**変換後**:
```markdown
# セッション終了記録

## 概要
セッション記録

## 内容
- 日時: 2025-10-23
- 種別: セッション終了
- ステータ ID: xxx

## 次アクション
- [ ] 必要に応じて内容を確認

#inbox #session-record
```

### 例2: PPTXファイルの変換（数値と実例を含む）

ファイル: `KPI Review (1H2025).pptx`

**処理手順**:
1. `extract_pptx.py`スクリプトを作成してテキスト抽出
2. 全てのスライドから数値、パーセンテージ、実例を抽出
3. 詳細な内容をInbox形式に変換

**変換後**:
```markdown
# KPI Review (1H2025)

## 概要
2025年上半期のKPIレビュープレゼンテーション資料

## 内容

### 売上実績
- **総売上**: USD 1,200万（前年比+15%）
- **コンテナ数**: 5,000 TEU（前年比+12%）

### 主要顧客別実績
- **顧客A社**: 200 TEU/月、レート USD 1,500/40HC
- **顧客B社**: 150 TEU/月、レート USD 1,800/40HC
- **顧客C社**: 100 TEU/月、レート USD 2,000/40HC

### 地域別実績
- **Chile**: 2,000 TEU（40%）
- **Mexico**: 1,500 TEU（30%）
- **Peru**: 1,000 TEU（20%）
- **Ecuador**: 500 TEU（10%）

## 次アクション
- [ ] 04_Memory/Work/ONE/Pricing/に移動を検討

#inbox #kpi #review #2025
```

### 例3: メール抽出結果の変換（数値と実例を含む）

ファイル: `メール抽出結果_ 01_Chile.md`

**処理手順**:
1. 大きなファイルなので`grep`を使って数値パターンを抽出
2. 顧客名、B/L番号、レート例、実例を全て抽出
3. トピックごとに分割してInbox形式に変換

**変換後**:
```markdown
# Chile-Pricing-主要顧客別ルール

## 概要
Chileの主要顧客別のレート設定ルール、ボリューム実績、特別条件をまとめたノート

## 内容

### Falabella [PE100604]
- **RFA**: TLIMB01138A
- **AP by Loop**: AX1: 64 TEU, AX2: 12 TEU, AX3: 24 TEU
- **Mexico POD追加**: 10 TEU/week for Nov-Dec
- **Free Time**: 14 days CTIC
- **レート実例**: Oct-2H: USD 1,750/2,200/2,200/2,200

### Pan South
- **AP実績**: 53 TEU/week
- **10月の損失**: 127 TEU (平均42 TEU/week)
- **12月AP**: 253 TEUs

## 次アクション
- [ ] 04_Memory/Work/ONE/Pricing/Chile/に移動を検討

#inbox #chile #pricing #customers
```

### 例4: XLSXファイルの変換（全シート・全データを詳細に取得）

ファイル: `Soon Ang takeover list.xlsx`（41シート、74,239行）

**処理手順**:
1. `extract_xlsx_complete.py`スクリプトを作成してテキスト抽出
2. **全てのシートを処理**（シート名を確認: 41シート）
3. **全ての行・列からデータを抽出**（サンプルではなく全量）
4. 各シートごとに構造化（シート名、行数、列数を明記）
5. 数値、日付、文字列など全てのセル内容を取得
6. 詳細な内容をInbox形式に変換

**変換後**:
```markdown
# Soon Ang Takeover List - 詳細版

## 概要
Soon Ang（担当者）からの引き継ぎリスト。41個のシートから構成され、LAWC（Latin West Coast）のプライシング、スペースコントロール、業務フローに関する詳細な引き継ぎ情報が含まれています。

## ファイル情報
- **元ファイル**: `Soon Ang takeover list.xlsx`
- **形式**: Excelスプレッドシート（41シート）
- **総行数**: 74,239行

## シート一覧（全41シート）

### 主要シート
1. **Soon Ang Probation** - 試用期間の評価項目（13行）
2. **Schedule** - スケジュールと引き継ぎ計画（79行）
3. **POD** - PODマッピング（AX1/AX2/AX3別）（62行）
4. **AX3 handover** - AX3スペースコントロールの引き継ぎ（1008行）
5. **Scope** - 担当範囲とバックアップ体制（86行）
6. **Pricing** - プライシング実務（1015行）
...

## 詳細内容

### 1. Soon Ang Probation（試用期間の評価項目）
[各シートの詳細な内容を記載]

### 2. Schedule（スケジュールと引き継ぎ計画）
[具体的な日付、時間、リソース情報を含む]

...

## 次アクション
- [ ] 各シートの詳細をMemory Noteに変換

#takeover #handover #soon-ang #lawc #pricing #space-control #inbox #detailed
```

**重要なポイント**:
- ❌ **ダメな例**: 「Soon Ang Takeover Listには、以下の内容が含まれている可能性があります」という推測のみ
- ✅ **良い例**: 全41シートの詳細な内容、具体的な数値（USD 400/BL、2265 TEU/22655 MTなど）、実例（VSLコード、メールアドレス、システムリンクなど）を全て含む

